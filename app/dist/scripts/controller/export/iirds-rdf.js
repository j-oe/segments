define(["controller/store","config/params","helper/util"],function(e,r,i){var t={label:"iiRDS Metadata (RDF)",extension:"rdf",filename:"fastclass_iirds_metadata"};return{register:function(){return t},condition:function(){return e.classifiedData&&0!==e.classifiedData.length},execute:function(){function t(r){for(var t='<rdf:RDF xmlns:iirds="http://iirds.tekom.de/iirds#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:dcterms="http://purl.org/dc/terms/"><iirds:Package rdf:about="'+i.getUUID()+'"><iirds:Version>1.0</iirds:Version><iirds:title>Metadata for '+e.classifiedFileSources[0]+"."+e.classifiedFileCurrentType+" based on model "+e.model.meta.modelName+"</iirds:title><iirds:identifier>"+e.model.meta.modelID+"</iirds:identifier><iirds:has-author>"+e.model.meta.modelCreator+"</iirds:has-author></iirds:Package>",a=0;a<r.length;a++)t+=s(r[a]);return t+="</rdf:RDF>"}function s(r){return'<iirds:Fragment rdf:about="'+i.getUUID()+'"><iirds:has-subject rdf:resource="http://iirds.tekom.de/iirds#'+r.clf+'"/><iirds:has-rendition><iirds:Rendition><iirds:format>application/'+e.classifiedFileCurrentType+"</iirds:format><iirds:source>"+e.classifiedFileSources[0]+"."+e.classifiedFileCurrentType+'</iirds:source><iirds:has-selector><iirds:RangeSelector><iirds:has-start-selector><iirds:FragmentSelector><dcterms:conformsTo rdf:resource="http://tools.ietf.org/rfc/rfc3778"/><rdf:value>page='+r.start+'</rdf:value></iirds:FragmentSelector></iirds:has-start-selector><iirds:has-end-selector><iirds:FragmentSelector><dcterms:conformsTo rdf:resource="http://tools.ietf.org/rfc/rfc3778"/><rdf:value>page='+r.end+"</rdf:value></iirds:FragmentSelector></iirds:has-end-selector></iirds:RangeSelector></iirds:has-selector></iirds:Rendition></iirds:has-rendition></iirds:Fragment>"}var a=new Worker(r.getParam("rgWorkerURL"));return new Promise(function(r,i){a.addEventListener("error",function(e){i(e)}),a.addEventListener("message",function(i){if(i.data.ready)a.postMessage(["findRanges",e.classifiedData]);else{a.terminate();var s=t(i.data),d=new DOMParser,n=new XMLSerializer,o=d.parseFromString(s,"application/xml"),l=n.serializeToString(o);r(l)}})})}}});